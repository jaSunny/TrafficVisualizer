-- get grid for # rides for given time and coordinates

SELECT ST_ClusterID() AS cluster_id, ST_ClusterEnvelope().ST_AsGeoJson() AS cluster_envelope, COUNT(*) AS counter
FROM "NYCCAB"."TRIP_SPATIAL_ANNOTATED"
WHERE TO_DATE(DROPOFF_TIME) >= '2010-06-01' AND TO_DATE(DROPOFF_TIME) <= '2010-06-10'
AND DROPOFF.ST_within('POLYGON((40.69664826715396 -74.02656555175781,40.728397037445035 -74.02656555175781,40.728397037445035 -73.96459579467773,40.69664826715396 -73.96459579467773,40.69664826715396 -74.02656555175781))') = 1
GROUP CLUSTER BY DROPOFF
USING GRID X BETWEEN 40.6991 AND 40.7235 CELLS 10 Y BETWEEN -74.0224 AND -73.9696 CELLS 10
ORDER BY cluster_id
WITH HINT (OLAP_PARALLEL_AGGREGATION)


